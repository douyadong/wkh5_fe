"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Pagination=function(){function t(e){_classCallCheck(this,t),this.setOptions(e),this.options.callback(),this.bindEvent()}return _createClass(t,[{key:"setOptions",value:function(t){var e={total:1,prePages:5,sufPages:4,dotsPages:7,showDotPages:3,sidePages:1,callback:null,container:null,numberStyle:""};$.extend(!0,this.options={},e,t)}},{key:"genPageNumber",value:function(t,e){var a=this,n=a.options.prePages,i=a.options.sufPages,o=a.options.dotsPages,r=a.options.showDotPages,s=a.options.sidePages,c=e||a.options.total,l=a.options.numberStyle,u="<a href='javascript:;' class='"+l+" page-link on'>"+t+"</a>";if(c<o){for(var p=t-1;p>=1;p--)u="<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"+u;for(var p=t+1;p<=c;p++)u=u+"<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"}else if(t<r+1){for(var p=t-1;p>=1;p--)u="<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"+u;for(var p=t+1;p<=n;p++)u=u+"<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>";u+="<span>...</span>",u=u+"<a href='javascript:;' class='"+l+" page-link'>"+c+"</a>"}else if(c-t<r){for(var p=t+1;p<=c;p++)u=u+"<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>";for(var p=t-1;p>c-i;p--)u="<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"+u;u="<span>...</span>"+u,u="<a href='javascript:;' class='"+l+" page-link'>1</a>"+u}else{for(var p=1;p<=s;p++)t-p>1&&(u="<a href='javascript:;' class='"+l+" page-link'>"+(t-p)+"</a>"+u),t-0+p<=c&&(u=u+"<a href='javascript:;' class='"+l+" page-link'>"+(t-0+p)+"</a>");t-s>1&&(u="<a href='javascript:;' class='page-link'>1</a><span>...</span>"+u),t+s<c&&(u=u+"<span>...</span><a href='javascript:;' class='"+l+" page-link'>"+c+"</a>")}u=1==t?"<a href='javascript:;' data-type='pre' data-pageindex='"+t+"' class='page-link disabled'>上一页</a>"+u:"<a href='javascript:;' data-type='pre' data-pageindex='"+t+"' class='page-link'>上一页</a>"+u,u=t==c?u+"<a href='javascript:;' data-type='next' data-pageindex='"+t+"' class='page-link disabled'>下一页</a>":u+"<a href='javascript:;' data-type='next' data-pageindex='"+t+"' class='page-link'>下一页</a>",a.options.container.append(u)}},{key:"bindEvent",value:function(){var t=this;t.options.container.undelegate("a","click").delegate("a","click",function(e){var a=$(this),n=parseInt(a.text()),i=a.data("type"),o=parseInt(a.attr("data-pageindex"));if(!a.hasClass("disabled")&&!a.hasClass("on")){switch(i){case"pre":n=o-1;break;case"next":n=o+1}n&&t.options.callback&&t.options.callback(n)}})}}]),t}();!function(t){var e=function n(e,a){this.$element=t(e),this.$Audio=this.$element.children("#media"),this.Audio=this.$Audio[0],this.$audio_area=this.$element.find("#audio_area"),this.$audio_length=this.$element.find("#audio_length"),this.$audio_progress=this.$element.find("#audio_progress"),this.currentState="pause",this.time=null,this.options=t.extend({},n.defaults,a),this.init()};e.pluginName="wechatAudio",e.dataName="wechataudio",e.version="1.0.0",e.defaults={autoplay:!1,src:"",callback:t.noop};e.prototype={init:function(){var t=this;t.Audio.addEventListener("durationchange",function(e){t.updateTotalTime(e.target.duration),console.log(e.target.duration)}),t.events(),""!==t.options.src&&t.changeSrc(t.options.src,this.options.callback),t.options.autoplay&&t.play()},play:function(){var t=this;return"play"===t.currentState?void t.pause():(t.Audio.play(),clearInterval(t.timer),t.timer=setInterval(t.run.bind(t),50),t.currentState="play",void t.$audio_area.addClass("playing"))},pause:function(){var t=this;t.Audio.pause(),t.currentState="pause",clearInterval(t.timer),t.$audio_area.removeClass("playing")},stop:function(){},events:function(){var t,e=this;e.$audio_area.on("click",function(){e.play(),t||(e.updateTotalTime(),t=!0)})},run:function(){var t=this;t.animateProgressBarPosition(),t.Audio.ended&&t.pause()},animateProgressBarPosition:function(){var t=this,e=100*t.Audio.currentTime/t.Audio.duration+"%";"NaN%"==e&&(e="0%");var a={width:e};t.$audio_progress.css(a)},getAudioSeconds:function(t){var e=this,t=t%60;return t=e.addZero(Math.floor(t),2),t=t<60?t:"00"},getAudioMinutes:function(t){var e=this,t=t/60;return t=e.addZero(Math.floor(t),2),t=t<60?t:"00"},addZero:function(t,e){var t=String(t);return t},updateTotalTime:function(t){var e=this,t=t||e.Audio.duration,a=e.getAudioMinutes(t),n=e.getAudioSeconds(t),i="";i="00"==a?n+"''":a+"'"+n+"''",e.$audio_length.text(i)},changeSrc:function(t,e){var a=this;return a.pause(),a.Audio.src=t,a.play(),e(),this}};var a=t.fn[e.pluginName];t.fn[e.pluginName]=function(a,n){return this.each(function(){var i=t(this),o=i.data(e.dataName),r="object"==("undefined"==typeof a?"undefined":_typeof(a))&&a;return o||i.data(e.dataName,o=new e(this,r)),"string"==typeof a&&o[a](n),this})},t.fn[e.pluginName].Constructor=e,t.fn[e.pluginName].noConflict=function(){return t.fn[e.pluginName]=a,this}}(window.Zepto||window.jQuery);var ArticleShareController=function(t){function e(t){_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=a;if(require(["../components/bigdata.min"],function(t){t.init(n),t.bigData({pageName:"1021",pageParam:{article_id:$.trim($("#articleId").val())},type:1})}),a.setOptions(t),a.setArticleFont(),a.articleId=$.trim($("#articleId").val()),a.cityId=$.trim($("#cityId").val()),a.refreshComment(),a.bindEvent(),a.convertLink(),a.convertVideo(),a.openInApp(),a.initWxShare(),a.loginStatus=!1,a.textareaHeight=$(".commentArea").find("textarea").height(),a.wkBigDataParams={pageName:1022,pageParam:{article_id:a.articleId},eventName:"",eventParam:{},nextPageName:"",nextPageParam:{},city:$("#cityId").val()},location.href.indexOf("#")>0&&"#comment-box"==location.href.slice(location.href.lastIndexOf("#"))){clearTimeout(i);var i=setTimeout(function(){$("html,body").scrollTop($("#comment-box").offset().top-200)},300)}return a}return _inherits(e,t),_createClass(e,[{key:"initWxShare",value:function(){}},{key:"openInApp",value:function(){var t=this.cityId,e=this.articleId;$(".download-app .download").click(function(){nativeSchema.loadSchema({schema:"external_call/parameter?t=0&bt=30&cd="+t+"&articleId="+e,protocal:"wkzf",loadWaiting:"1500",failUrl:"https://m.wkzf.com/download/transit?from=esfDetail",apkInfo:{PKG:"com.wukong.ua",CATEGORY:"android.intent.category.DEFAULT",ACTION:"android.intent.action.VIEW"}})})}},{key:"getQueryString",value:function(t,e){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=t.match(a),i="";return null!=n&&(i=n[2]),a=null,n=null,null==i||""==i||"undefined"==i?"":i}},{key:"convertLink",value:function(){var t=this,e=$(".article-content").find("a");return!(!e||!e.length)&&void $.each(e,function(e,a){var n=$(a),i=n.attr("href");if(i){var o,r,s=i.split("?");s&&("wkzf://discovery/parameter?articleId="===s[0]?s[1]&&(o=t.getQueryString(s[1],"articleId"),n.attr("href","/article/app-share."+o+".html")):"wkzf://discovery/parameter?categoryId="===s[0]&&s[1]&&(r=t.getQueryString(s[1],"categoryId"),n.attr("href","/category/app."+r+".html?cityId="+t.cityId)))}})}},{key:"convertVideo",value:function(){var t=$(".article-content").find("embed");return!(!t||!t.length)&&void $.each(t,function(t,e){var a,n,i=$(e),o=$.trim($("#coverUrl").val()),r=i.attr("src"),s=r&&r.split("."),c=s[s.length-1];"mp3"===c.toLowerCase()?(n='<p class="weixinAudio">',n+='<audio src="'+r+'" id="media" width="1" height="1" preload="auto"></audio>',n+='<span id="audio_area" class="db audio_area">',n+='<span class="audio_arrow_back"></span>',n+='<span class="audio_arrow"></span>',n+='<span class="audio_wrp db">',n+='<span class="audio_play_area">',n+='<i class="icon_audio_default"></i>',n+='<i class="icon_audio_playing"></i>',n+="</span>",n+='<span id="audio_progress" class="progress_bar"></span>',n+="</span>",n+="</span>",n+='<span id="audio_length" class="audio_length tips_global"></span>',n+="</p>",i.after($(n)),i.remove()):(a=$('<video src="'+i.attr("src")+'" controls="controls">您的浏览器不支持 video 标签。</video>'),a.attr({poster:o,preload:"auto"}),i.attr({type:"",width:"100%",height:"100%"}),i.after(a),i.remove()),$(".weixinAudio").wechatAudio({autoplay:!1})})}},{key:"refreshComment",value:function(){var t=this,e=new Pagination({prePages:4,callback:function(a){a=a||1;var n=10*(a-1);t.request(t.apiUrl.essay.commentList,{articleId:t.articleId,pageIndex:n},{successCallback:function(n){return t.createCommentList(n),$(".pagination").empty(),n.count?($(".pagination").show(),void e.genPageNumber(a,Math.ceil(n.count/10))):($(".pagination").hide(),!1)}})},container:$(".pagination"),numberStyle:"page-number"})}},{key:"createCommentList",value:function(t){var e=[];return!(!t.data||!t.data.length)&&($(".comment-list").empty(),$.each(t.data,function(t,a){e.push('<div class="item">'),e.push('<div class="commenter pb-10">'),e.push('<img src="'+a.guestPhoto+'" alt="">'),e.push('<span class="name">'+(a.guestNickname?a.guestNickname.replace(":",""):"")+"</span>"),e.push("</div>"),e.push('<div class="content pb-10">'+a.commentContent+"</div>"),e.push('<div class="datetime">'),e.push('<span class="date">'+a.date+"</span>"),e.push('<span class="time">'+a.time+"</span>"),e.push("</div>"),e.push("</div>")}),void $(".comment-list").append(e.join("")))}},{key:"setArticleFont",value:function(){$(".article-content [style]").removeAttr("style").removeAttr("class"),$(".article-content").show()}},{key:"bindEvent",value:function(){var t=this;$(".zan").on("click",function(){var e=$(this);e.find("i").first();return e.hasClass("active")?void $.tips("您已经赞过",2):void t.request(t.apiUrl.essay.zan,{articleId:t.articleId},{successCallback:function(t){if(1===t.status&&t.data){var a=e.children("span").text()||0;a=/^\d*$/.test(a)?parseInt(a)<9999?parseInt(a)+1:"1万+":e.text(),e.addClass("active").find("span").text(t.data)}}})}),$('[name="comment"]').keyup(function(){var t=$(this),e=t.val();e&&e.length>0?(t.parent().css("border-color","#76B4E8"),$(".comment .submit").css({color:"#4081D6","border-color":"#4081D6"})):(t.parent().css("border-color","#E4E4E4"),$(".comment .submit").css({color:"#999","border-color":"#999"}))}),$(".comment").on("click",".cancel",function(){var e=$('[name="comment"]');e.val("").height(t.textareaHeight||75),e.parent().css("border-color","#E4E4E4"),$(".comment .submit").css({color:"#999","border-color":"#999"})});var e=!1;$(".comment").on("click",".submit",function(a){if(a.preventDefault(),!e){var n=$("[name=comment]"),i=$.trim(n.val());if(0===i.length)return $.tips("评论内容不能为空",1),!1;$(".comment .submit").css({color:"#999","border-color":"#999"}),e=!0,t.request(t.apiUrl.essay.comment,{articleId:t.articleId,comment:i},{successCallback:function(a){if($(".comment .submit").css({color:"#4081D6","border-color":"#4081D6"}),e=!1,1===a.status&&a.data){$.tips("评论成功",2);var i=$("#comment-box").find(".count"),o=parseInt(i.text())||0,r=i.text();o?a.data.commentNumStr?i.text(a.data.commentNumStr):/^\d*$/.test(r)&&(parseInt(r)<9999?i.text(parseInt(r)+1):i.text("1万+")):$("#comment-box").find(".title").empty().append('评论（<span class="count">1</span> )'),$(".no-commet").remove(),n.val(""),$(".comment .submit").css({color:"#999","border-color":"#999"}),$("html,body").scrollTop($("#comment-box").offset().top-200),t.refreshComment()}else $.tips("评论失败",2)}})}}),window.addEventListener("resize",function(t){var e=$('[name="comment"]');e.scrollIntoView(!1)})}},{key:"setOptions",value:function(t){var e={};$.extend(!0,this.options={},e,t)}}]),e}(Controller);$(document).ready(function(){new ArticleShareController});
//# sourceMappingURL=app-in.min.js.map
