{"version":3,"sources":["community/detail.min.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","DetailController","_Controller","this","_this","getPrototypeOf","$","on","window","history","go","require","Album","PreviewImage","that","encryptsubestateid","attr","request","apiUrl","community","chart","subEstateId","successCallback","data","status","dataRes","echartData","recombineM","echartFun","seriesData","countNum","echartShow","forEach","item","index","push","parseFloat","hide","sortArray","sort","a","b","maxPrice","Math","ceil","notZroArray","minPrice","avgPrice","colorChang","myChart","echarts","init","document","getElementById","width","houseId","subestateid","echartBigData","eventName","eventParam","house_id","estate_id","type","option","tooltip","trigger","triggerOn","position","backgroundColor","padding","textStyle","color","fontSize","formatter","params","ticket","callback","paramsValue","common","bigData","grid","bottom","left","right","containLabel","xAxis","monthList","splitLine","show","axisTick","boundaryGap","axisLine","lineStyle","axisLabel","interval","rotate","fontFamily","yAxis","inside","toFixed","min","max","series","name","normal","itemStyle","emphasis","borderColor","borderWidth","symbolSize","connectNulls","setOption","month","date","split","indexOf","charAt","unitPrice","console","log","Controller","ready"],"mappings":"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","file":"detail.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n 1. 项目名称：悟空找房h5\r\n 2. 页面名称：subestate/detail(小区-详情)\r\n 3. 作者：tangxuyang@lifang.com\r\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n class DetailController extends Controller {\r\n    constructor() {\r\n        super() ;             \r\n        let self = this ;\r\n        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n        页面顶部的返回按钮\r\n        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n        $('.icon-back').on('click',function(){\r\n            window.history.go(-1) ;\r\n        }) ;\r\n        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n        相册集图片预览功能\r\n        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n        require(['../components/album.min','../components/preview-image.min'],function(Album, PreviewImage){\r\n            PreviewImage('.subestate-comments');\r\n        }) ;\r\n        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n        请求接口 获取折线图参数\r\n        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n        let that = this;\r\n        // 获取小区加密Id\r\n        let  encryptsubestateid = $('#estateNameEcharts').attr('data-encryptsubestateid');\r\n        this.request(this.apiUrl.community.chart,{subEstateId:encryptsubestateid},{successCallback(data){\r\n                if (data.status == 1){\r\n                    let dataRes = data;\r\n                    let echartData =  that.recombineM(dataRes.data);\r\n                    that.echartFun(echartData) ;\r\n                }\r\n            }});\r\n    };\r\n\r\n     /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n     折线图函数异步操作\r\n     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n     echartFun(echartData){\r\n         let seriesData=[];\r\n         let countNum = 0;\r\n         let echartShow = true;\r\n         echartData.seriesData.forEach(function(item,index){\r\n             if(item == 0){\r\n                 seriesData.push(null);\r\n                 countNum += 1;\r\n                 if (countNum == 11 && index == 10){\r\n                     echartShow = false;\r\n                 }\r\n             }else{\r\n                 seriesData.push(parseFloat(item));\r\n             }\r\n         });\r\n         if (!echartShow) {\r\n             $('#estateNameEcharts').hide();\r\n             return\r\n         }\r\n         let sortArray = echartData.seriesData.sort(function(a, b) {\r\n             return parseFloat(a) - parseFloat(b);\r\n         });\r\n         /* 按照3.12需求文档走势图数据要求*/\r\n         let maxPrice = Math.ceil((sortArray[sortArray.length - 1] / 1000)) * 1000;\r\n         let notZroArray = [];\r\n         sortArray.forEach(function (item,index) {\r\n             if (item != 0){\r\n                 notZroArray.push(item)\r\n             }\r\n         });\r\n         let minPrice = Math.ceil((notZroArray[0] / 1000) - 1) * 1000;\r\n         let avgPrice = 1000 ;\r\n         if (sortArray[sortArray.length - 1] == notZroArray[0] ) {\r\n             minPrice = minPrice - 2000;\r\n             avgPrice = 1000\r\n         }else{\r\n             avgPrice = (maxPrice - minPrice)/4 < 1000 ? 1000:Math.ceil((maxPrice - minPrice)/4000)*1000;\r\n         }\r\n         minPrice =  minPrice < 0 ? 0:minPrice;\r\n         let colorChang = (minPrice-avgPrice > 0  ||  minPrice == 0)? '#979797':'#fff';\r\n         let myChart = echarts.init(document.getElementById('main'),{ width: '88%' });\r\n         let that = this;\r\n         // 给折线图dome增加埋点\r\n         let houseId =  $('#estateName').attr('data-houseid');\r\n         let subestateid =  $('#estateName').attr('data-subestateid') ;\r\n         let echartBigData = {\r\n             \"eventName\": \"1067014\",\r\n             \"eventParam\": { \"house_id\" : houseId , \"estate_id\": subestateid },\r\n             \"type\": 2\r\n         };\r\n         // 指定图表的配置项和数据\r\n         let option = {\r\n             tooltip: {      // 提示框\r\n                 trigger: 'item',\r\n                 triggerOn: 'click',\r\n                 position: 'top',\r\n                 backgroundColor: '#4081D6',\r\n                 padding: 4,\r\n                 textStyle: {\r\n                     color: '#fff',\r\n                     fontSize: '12'\r\n                 },\r\n                 formatter:function (params, ticket, callback) {\r\n                     let paramsValue =  params.value + \"元\";\r\n                     that.request(that.apiUrl.common.bigData , echartBigData ,function () {\r\n\r\n                     });\r\n                     return paramsValue;\r\n                 }\r\n             },\r\n             grid: {\r\n                 bottom: 20,\r\n                 left: '3%',\r\n                 right: '10%',\r\n                 containLabel: true,\r\n             },\r\n             xAxis: {\r\n                 data: echartData.monthList ,  // X坐标数据\r\n                 splitLine: {show: false}, // 控制网格线是否显示\r\n                 axisTick: {show: false},  // 去除x轴上的刻度线\r\n                 position: 'bottom',\r\n                 type: 'category',\r\n                 boundaryGap: false,\r\n                 axisLine: {\r\n                     lineStyle: {\r\n                         color: colorChang, // x轴颜色\r\n                     }\r\n                 },\r\n                 axisLabel: {\r\n                     interval: 0,\r\n                     rotate: 0, //60度角倾斜显示\r\n                     textStyle: {\r\n                         color: '#999',\r\n                         fontSize: 12,\r\n                         fontFamily: '微软雅黑'\r\n                     }\r\n                 },\r\n             },\r\n             yAxis: {\r\n                 axisLine: {show: false},   // y轴是否显示\r\n                 splitLine: {\r\n                     show: true,  // 控制网格线是否显示\r\n                     lineStyle: {\r\n                         color: ['#979797'] // y刻度颜色\r\n                     }\r\n                 },\r\n                 axisTick: {show: false},// 去除y轴上的刻度线\r\n                 axisLabel:{\r\n                     inside: false,\r\n                     textStyle: {\r\n                         color: '#999',\r\n                     },\r\n                     formatter: function(value, index) {\r\n                         if ( index == 0) {\r\n                             return \"\";\r\n                         } else {\r\n                             return (value / 10000).toFixed(1) + ' 万';\r\n                         }\r\n                     }\r\n                 },\r\n                 min: minPrice - avgPrice,\r\n                 max: minPrice+avgPrice * 4,\r\n                 interval:avgPrice,\r\n             },\r\n             series: [{\r\n                 name: '销量',\r\n                 type: 'line',\r\n                 lineStyle:{\r\n                     normal:{\r\n                         color:'#4081D6', // 折线条颜色\r\n                     }\r\n\r\n                 },\r\n                 itemStyle:{\r\n                     normal:{\r\n                         color: \"#4081D6\", //图标颜色\r\n                     },\r\n                     emphasis: { //重点，强调时候的样式，即当鼠标悬停或点击上去的时候的拐点的样式\r\n                         borderColor: '#4081D6',\r\n                         borderWidth: 2,\r\n                         color: '#4081D6'\r\n                     }\r\n                 },\r\n                 symbolSize: 5,\r\n                 connectNulls: true,\r\n                 data: seriesData,\r\n             }],\r\n         };\r\n         myChart.setOption(option);\r\n     };\r\n     /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n     处理得到的数据的函数  处理月份和数据\r\n     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n     recombineM(data) {\r\n         let echartData = {\r\n             monthList: [],\r\n             seriesData: []\r\n         };\r\n         if (data) {\r\n             data.forEach((item) => {\r\n                 let month = item.date.split('-')[1];\r\n                 if (month.indexOf('0') == 0) {\r\n                     echartData.monthList.push(month.charAt(1)+'月')\r\n                 } else {\r\n                     echartData.monthList.push(month+'月')\r\n                 }\r\n                 echartData.seriesData.push(item.unitPrice)\r\n             });\r\n         }\r\n         console.log(echartData);\r\n         return echartData ;\r\n     }\r\n}\r\n/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n类的初始化\r\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n$(document).ready(function() {\r\n    new DetailController;\r\n}) ;\r\n"]}