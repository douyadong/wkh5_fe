{"version":3,"sources":["components/trend-search.min.js"],"names":["define","that","houseListType","selectFun","select","$","click","show","JSON","parse","localStorage","getItem","searchHistory","reverse","listSearchHistory","bigdata","encodeURIComponent","stringify","eventName","channel","type","forEach","item","index","id","key","address","empty","append","singleData","this","attr","historyList","hide","val","parent","submit","event","preventDefault","removeItem","on","listData","searchaAcWord","sendData","cityId","cookie","pageName","request","apiUrl","common","acWord","successCallback","data","secondHouseList","titleName","addreName","estateDesc","replace","markname","value","keyCode","saveLocalStorage","splice","length","saveLocal","push","setItem","houseT","cityPinYin","window","location","href","init","c","houseType"],"mappings":"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","file":"trend-search.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n 1. 项目名称：悟空找房h5\r\n 2. 页面名称：components -> trendSearch（搜索框的组件）\r\n 3. 作者：liyang@lifang.com\r\n    参数说明：\r\n    selectName 点击的class\r\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n\r\ndefine(function(){\r\n    let that;\r\n    let houseListType= 'oldhouselist';  // 二手房或者新房来源标识\r\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n    点击icon搜索框的出现\r\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n    let selectFun = function (select) {\r\n        $(`.${select}`).click(function () {\r\n            $('#search').show();\r\n            /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n            // Storage取值渲染搜索历史\r\n            -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n            if (JSON.parse(localStorage.getItem(houseListType)) ) {\r\n                $('.history').show();\r\n                let searchHistory = JSON.parse(localStorage.getItem(houseListType)).reverse();\r\n                let listSearchHistory ='';\r\n                /* 埋点的参数*/\r\n                let bigdata =encodeURIComponent(JSON.stringify({\r\n                    eventName: '1203005',\r\n                    channel:\"channelFlag\" ,\r\n                    type: 2\r\n                }));\r\n                searchHistory.forEach(function (item,index) {\r\n                        listSearchHistory += `<li data-bigdata=\"${bigdata} \" data-type=\"${item.type}\" data-value=\"${item.id}\" data-name=\"${item.key}\" data-address=\"${item.address}\"><p>${item.key}</p><span>${item.address}</span></li>`\r\n                });\r\n                $('#resultHistory').empty().append(listSearchHistory);\r\n                // 历史搜索点击\r\n                $('#resultHistory >li').click(function () {\r\n                    let singleData = {\r\n                        \"key\":$(this).attr('data-name'),\r\n                        \"id\": $(this).attr('data-value'),\r\n                        \"address\": $(this).attr('data-address'),\r\n                        \"type\":$(this).attr('data-type'),\r\n                    };\r\n                    historyList(singleData)\r\n                })\r\n            }else {\r\n                $('.history').hide();\r\n            }\r\n        });\r\n    };\r\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n    点击icon搜索框的隐藏\r\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n    $('.icon-fanhui').click(function () {\r\n        $('#search').hide();\r\n    });\r\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n    点击icon搜索框的清空\r\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n    $('.icon-close').click(function () {\r\n        $('#searchInput').val('');\r\n        $('#showResult').empty().append().parent().hide();\r\n        $(this).hide();\r\n        $('.no-result').hide();\r\n    });\r\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n    阻止表单的默认行为：\r\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n    $('.input-kw-form').submit(function(event){\r\n        event.preventDefault();\r\n    });\r\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n    清楚搜索历史\r\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n    $('#clearHistory').click(function () {\r\n        localStorage.removeItem('searchTrendHistory');\r\n        $('#resultHistory').empty();\r\n        $('.history').hide();\r\n    });\r\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n    联想词的检索\r\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n    $('#searchInput').on('keyup input',function () {\r\n        if ($(this).val()) {\r\n            $('.icon-close').show();\r\n            $('.history').hide();\r\n            let listData; // 搜索联想结果\r\n            let searchaAcWord =''; // 拼装dome节点\r\n            let sendData={\r\n                key:$(this).val(),\r\n                cityId:$.cookie('cityId') || 43,\r\n                pageName: houseListType\r\n            };\r\n            /* 埋点的参数*/\r\n            let bigdata =encodeURIComponent(JSON.stringify({\r\n                eventName: '1203004',\r\n                channel:\"channelFlag\" ,\r\n                type: 2\r\n            }));\r\n            that.request(that.apiUrl.common.acWord,sendData,{successCallback(data){\r\n                      listData = data.data;\r\n                    if (listData.secondHouseList){\r\n                       $('.have-result').show();\r\n                       $('.no-result').hide();\r\n                        let titleName ='';\r\n                        let addreName = '';\r\n                        listData.secondHouseList.forEach(function (item,index) {  // 循环出搜索结果\r\n                            if (item.type == 1 || item.type == 2 || item.type == 5) {\r\n                                titleName = item.estateDesc.replace(item.markname, `<span>${item.markname}</span>`);\r\n                                addreName = item.address.replace(item.markname, `<span>${item.markname}</span>`);\r\n                                searchaAcWord += `<li data-bigdata=\"${bigdata} \" data-type=\"${item.type}\" data-value=\"${item.value}\" data-name=\"${item.estateDesc}\" data-address=\"${item.address}\"><p>${titleName}</p><span>${addreName}</span></li>`\r\n                            }\r\n                        }) ;\r\n                        $('#showResult').empty().append(searchaAcWord);\r\n                    }else {\r\n                        $('#showResult').empty();\r\n                        $('.have-result').hide();\r\n                        $('.history').hide();\r\n                        $('.no-result').show();\r\n                    }\r\n                    $('#showResult > li').click(function () {\r\n                        let singleData = {\r\n                            \"key\":$(this).attr('data-name'),\r\n                            \"id\": $(this).attr('data-value'),\r\n                            \"address\": $(this).attr('data-address'),\r\n                            \"type\":$(this).attr('data-type'),\r\n                        };\r\n                        historyList(singleData)\r\n                    })\r\n                }});\r\n            if (searchaAcWord) { // enter键出发的搜索\r\n                if (event.keyCode == 13) {\r\n                    let singleData = {\r\n                        \"key\": $('#showResult>li:eq(0)').attr('data-name'),\r\n                        \"id\": $('#showResult>li:eq(0)').attr('data-value'),\r\n                        \"address\": $('#showResult>li:eq(0)').attr('data-address'),\r\n                        \"type\": $('#showResult>li:eq(0)').attr('data-type'),\r\n                    };\r\n                    historyList(singleData)\r\n                }\r\n            }\r\n        }else {\r\n            $('#showResult').empty().parent().hide();\r\n            $('.icon-close').hide();\r\n            if (localStorage.getItem(houseListType)){\r\n                $('.history').show();\r\n            }else {\r\n                $('.history').hide();\r\n            }\r\n\r\n        }\r\n    });\r\n    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n    联想词的检索历史储存到localStorage\r\n    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n    let historyList = function (singleData) {\r\n       let  saveLocalStorage = JSON.parse(localStorage.getItem(houseListType)) ? JSON.parse(localStorage.getItem(houseListType)) : [];\r\n        saveLocalStorage.forEach(function (item, index) {\r\n            if (item.id == singleData.id && item.type == singleData.type) {\r\n                saveLocalStorage.splice(index, 1)\r\n            }\r\n        });\r\n        if (saveLocalStorage.length > 4) {\r\n            saveLocalStorage.reverse().splice(4)\r\n        }\r\n        let saveLocal = saveLocalStorage.reverse();\r\n        saveLocal.push(singleData);\r\n        localStorage.setItem(houseListType, JSON.stringify(saveLocal));\r\n        let houseT =  houseListType==\"oldhouselist\" ? \"esf\":\"new\";\r\n        let cityPinYin = $.cookie('pinyin');\r\n        if (singleData.type == 1){\r\n            window.location.href = `${cityPinYin}/trend/${houseT}/district/${singleData.id}`\r\n        }else if (singleData.type == 2) {\r\n            /*console.log(`/trend/${houseT}/town/${singleData.id}`);*/\r\n            window.location.href = `${cityPinYin}/trend/${houseT}/town/${singleData.id}`\r\n        }else if (singleData.type == 5) {\r\n           /* console.log(`/trend/${houseT}/community/${singleData.id}`);*/\r\n            window.location.href = `${cityPinYin}/trend/${houseT}/community/${singleData.id}`\r\n        }\r\n    };\r\n    return {\r\n        init: function(c,houseType){\r\n            that = c;\r\n            houseListType = houseType || \"oldhouselist\";\r\n        },\r\n        selectFun : selectFun\r\n    }\r\n});"]}