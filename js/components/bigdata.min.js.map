{"version":3,"sources":["components/bigdata.min.js"],"names":["define","getDeviceId","cb","ls","getLocalStorage","window","localStorage","getBigData","bigData","JSON","parse","setBigData","data","stringify","getTotal","bigDataTotal","parseInt","setTotal","total","insertBigData","item","items","push","send","controller","request","apiUrl","successCallback","traverse","length","splice","deviceId","cookieId","pNum","document","body","addEventListener","event","$target","$","target","decodeURIComponent","type","$parents","parents"],"mappings":"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","file":"bigdata.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n 1. 项目名称：悟空找房h5\n 2. 页面名称：components -> bigdata(埋点)\n 3. 作者：tangxuyang@lifang.com\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\ndefine(function(){\n    //获取设备Id\n    function getDeviceId(cb){\n        //原生优先，然后取localStorage\n\n        \n        cb(\"2343434\");\n    }\n\n    let ls = {};\n    let getLocalStorage = function(){\n        return window.localStorage || ls;\n    };\n\n    //从localStorage中读取未成功的大数据埋点\n    let getBigData = function(){\n        if(getLocalStorage().bigData){\n            return JSON.parse(getLocalStorage().bigData);\n        }else{\n            return [];\n        }\n    };\n\n    //设置未成功的大数据埋点到localStorage\n    let setBigData = function(data){\n        getLocalStorage().bigData = JSON.stringify(data);\n    };\n\n    let getTotal = function(){\n        if(getLocalStorage().bigDataTotal){\n            return parseInt(getLocalStorage().bigDataTotal);\n        }else{\n            return 1;\n        }\n    }\n\n    let setTotal = function(total){\n        getLocalStorage().bigDataTotal = total;\n    }\n\n    //插入一条埋点数据到localStorage\n    let insertBigData = function(item){\n        let items = getBigData()||[];\n        items.push(item);\n        setBigData(items);\n    }\n\n    //发送埋点请求\n    let send = function(item){\n        if(window.controller){\n            let total = getTotal();\t\n            let controller = window.controller;\t\n            \n            controller.request(controller.apiUrl.bigData,item,{\n                successCallback: function(){\n\n                }\n            });            \n        }\n        \n    };\n\n    //从localStorage中读取一个bigData发送出去\n    let traverse = function(){\n        let items = getBigData();\n        if(items && items.length > 0){\n            let item = items.splice(0,1)[0];\n            setBigData(items);\n            send(item);\n        }\n    };\n\n    function bigData(data){               \n        getDeviceId(function(deviceId){\n            data.cookieId = deviceId;\n            let total = getTotal();\n            data.pNum = total;\n            setTotal(total+1);\n            send(data);\n        });        \n    };\n\n    //body上注册click事件，监听click事件\n    window.document.body.addEventListener(\"click\",function(event){\n        //判断是否埋点元素\n        let $target = $(event.target);\n        let data = $target.data('bigdata');\n        if(data){\t\t\t\t\t\t\t\t\n            data = JSON.parse(decodeURIComponent(data));\n            data.type = 2;//事件埋点的类型是2,1是pv\t\t\t\t\n            bigData(data);\n        }else{\n            let $parents = $target.parents('[data-bigdata]');\n            \n            if($parents.length>0){\t\t\t\t\t\n                data = $parents.data('bigdata');\n                data = JSON.parse(decodeURIComponent(data));\n                data.type = 2;\n                bigData(data);\n            }\n        }\n    },true);\n\n    return {\n        bigData: bigData\n    };\n});\n"]}