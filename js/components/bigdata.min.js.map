{"version":3,"sources":["components/bigdata.min.js"],"names":["define","s4","Math","random","toString","substring","guid","getCookieId","localStorage","cookieId","getDeviceId","cb","ls","getLocalStorage","window","getBigData","bigData","JSON","parse","setBigData","data","stringify","getTotal","bigDataTotal","parseInt","setTotal","total","insertBigData","item","items","push","controller","send","request","apiUrl","common","successCallback","isShowErrorTips","traverse","length","splice","deviceId","projectId","pNum","current_url","location","href","previous_url","document","referrer","longitude","$","cookie","latitude","channel","match","body","addEventListener","event","$target","target","decodeURIComponent","type","$parents","parents","init","c"],"mappings":"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","file":"bigdata.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n 1. 项目名称：悟空找房h5\n 2. 页面名称：components -> bigdata(埋点)\n 3. 作者：tangxuyang@lifang.com\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\ndefine(function(){\n    function s4() {\n        return ((( 1 + Math.random() ) * 0x10000) | 0 ).toString(16).substring(1) ;\n    }\n    //生成GUID\n    function guid() {\n        return s4() + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + s4() + s4() ; \n    } \n    //从cookie里面取得wkwapsid，如果没有用guid填充再返回\n    function getCookieId() {        \n        if(!localStorage.cookieId ) localStorage.cookieId = guid() ;\n        return localStorage.cookieId ;        \n    }\n\n    //获取设备Id\n    function getDeviceId(cb){\n        //原生优先，然后取localStorage\n        //当前页面都是分享页，没有跟native交互的场景，因此native交互这块先不实现\n\n        cb(getCookieId());\n    }\n\n    let ls = {};\n    let getLocalStorage = function(){\n        return window.localStorage || ls;\n    };\n\n    //从localStorage中读取未成功的大数据埋点\n    let getBigData = function(){\n        if(getLocalStorage().bigData){\n            return JSON.parse(getLocalStorage().bigData);\n        }else{\n            return [];\n        }\n    };\n\n    //设置未成功的大数据埋点到localStorage\n    let setBigData = function(data){\n        getLocalStorage().bigData = JSON.stringify(data);\n    };\n\n    let getTotal = function(){\n        if(getLocalStorage().bigDataTotal){\n            return parseInt(getLocalStorage().bigDataTotal);\n        }else{\n            return 1;\n        }\n    }\n\n    let setTotal = function(total){\n        getLocalStorage().bigDataTotal = total;\n    }\n\n    //插入一条埋点数据到localStorage\n    let insertBigData = function(item){\n        let items = getBigData()||[];\n        items.push(item);\n        setBigData(items);\n    }\n\n    //发送埋点请求\n    let controller;\n    let send = function(item){\n        if(controller){\n            let total = getTotal();\t\n\n            controller.request(controller.apiUrl.common.bigData,item,{\n                successCallback: function(){\n\n                },\n                isShowErrorTips: false,\n            });            \n        }\n        \n    };\n\n    //从localStorage中读取一个bigData发送出去\n    let traverse = function(){\n        let items = getBigData();\n        if(items && items.length > 0){\n            let item = items.splice(0,1)[0];\n            setBigData(items);\n            send(item);\n        }\n    };\n\n    function bigData(data){               \n        getDeviceId(function(deviceId){\n            data.cookieId = deviceId;\n            data.projectId = 2;\n            let total = getTotal();\n            data.pNum = total;\n            setTotal(total+1);\n            // 尝试从url中获取channel,从cookie中获取经纬度，还有当前url和之前url\n            data.current_url = location.href;\n            data.previous_url = document.referrer;\n            var longitude = $.cookie('locationLongitude');\n            var latitude = $.cookie('locationLatitude');\n            if(longitude){\n                data.longitude = longitude;\n            }\n            if(latitude){\n                data.latitude = latitude;\n            }\n            var channel = location.href.match(/channel=([^&]*)/i);\n            if(channel){\n                data.channel = channel[1];\n            }\n            send(data);\n        });        \n    };\n\n    //body上注册click事件，监听click事件\n    window.document.body.addEventListener(\"click\",function(event){\n        //判断是否埋点元素\n        let $target = $(event.target);\n        let data = $target.data('bigdata');\n        if(data){\t\t\t\t\t\t\t\t\n            data = JSON.parse(decodeURIComponent(data));\n            data.type = 2;//事件埋点的类型是2,1是pv\t\t\t\t\n            bigData(data);\n        }else{\n            let $parents = $target.parents('[data-bigdata]');\n            \n            if($parents.length>0){\t\t\t\t\t\n                data = $parents.data('bigdata');\n                if(data){\n                    data = JSON.parse(decodeURIComponent(data));\n                    data.type = 2;\n                    bigData(data);\n                }\n            }\n        }\n    },true);\n\n    return {\n        init: function(c){\n            controller = c;\n        },\n        bigData: bigData\n    };\n});\n"]}