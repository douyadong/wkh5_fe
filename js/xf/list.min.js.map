{"version":3,"sources":["xf/list.min.js"],"names":["ListController","self","total","count","pageSize","paramGenerator","ParamGenerator","$","slideUp","require","Filter","filter","el","houseType","cityId","near","longitude","latitude","distances","value","text","controller","filterChanged","result","console","log","param","generateParamObj","hideNoData","hideNoMore","fetchData","data","empty","showNoMore","newHouseDataListModelList","length","showNoData","createHouseList","trigger","qs","object2QueryString","window","history","pushState","onpopstate","event","state","tempArr","location","href","split","str","startsWith","substring","queryString2Object","setValue","convert2FilterParam","bindEvent","pullload","click","clear","forEach","item","imageUrl","estateName","districtName","townName","startSpace","endSpace","unitPrice","hide","createHouseItems","html","slideDown","setTimeout","insertTrendAndOldHouse","append","show","success","error","showLoading","request","apiUrl","xf","list","type","successCallback","errorCallback","completeCallback","hideLoading","cityName","$list","insertAfter","queryStringObject","pa","requestType","threshold","pageIndexKey","pageSizeKey","callback","appendHouseList","replaceState","Controller","document","ready"],"mappings":";;;;;;;;;;AAAA;;;;;IAKOA,c;;;AACH,8BAAc;AAAA;;AAAA;;AAEV,YAAIC,YAAJ;AACA,cAAKC,KAAL,GAAa,CAAb,CAHU,CAGK;AACf,cAAKC,KAAL,GAAa,CAAb,CAJU,CAIK;AACf,cAAKC,QAAL,GAAgB,EAAhB,CALU,CAKS;AACnB,cAAKC,cAAL,GAAsB,IAAIC,cAAJ,EAAtB;AACAC,UAAE,QAAF,EAAYC,OAAZ;AACAC,gBAAQ,CAAC,0BAAD,CAAR,EAAsC,UAASC,MAAT,EAAgB;AAClDT,iBAAKU,MAAL,GAAc,IAAID,MAAJ,CAAW;AACrBE,oBAAI,SADiB;AAErBC,2BAAW,CAFU;AAGrBC,wBAAQ,EAHa;AAIrBC,sBAAM,KAJe;AAKrBC,2BAAW,GALU;AAMrBC,0BAAU,GANW;AAOrBC,2BAAW,CAAC,EAACC,OAAO,MAAR,EAAgBC,MAAM,UAAtB,EAAD,EAAmC,EAACD,OAAO,KAAR,EAAeC,MAAM,MAArB,EAAnC,EAAgE,EAACD,OAAO,MAAR,EAAgBC,MAAM,OAAtB,EAAhE,EAA+F,EAACD,OAAO,MAAR,EAAgBC,MAAM,OAAtB,EAA/F,EAA8H,EAACD,OAAO,MAAR,EAAgBC,MAAM,OAAtB,EAA9H,CAPU;AAQrBC,4BAAYpB,IARS;AASrBqB,+BAAe,uBAASC,MAAT,EAAgB;AAC3B,yBAAKrB,KAAL,GAAa,CAAb;AACA,yBAAKC,KAAL,GAAa,CAAb;AACAqB,4BAAQC,GAAR,CAAY,SAAZ,EAAuBF,MAAvB;AACA,wBAAIG,QAAQzB,KAAKI,cAAL,CAAoBsB,gBAApB,CAAqCJ,MAArC,CAAZ;AACA;AACAtB,yBAAKyB,KAAL,GAAaA,KAAb;AACAzB,yBAAK2B,UAAL;AACA3B,yBAAK4B,UAAL;AACA5B,yBAAK6B,SAAL,CAAeJ,KAAf,EAAqB,UAASK,IAAT,EAAc;AAC/BA,+BAAOA,KAAKA,IAAZ;AACAxB,0BAAE,OAAF,EAAWyB,KAAX;AACA,4BAAGD,KAAK7B,KAAL,IAAY,CAAZ,IAAiB6B,KAAK7B,KAAL,IAAYD,KAAKG,QAArC,EAA8C;AAAC;AAC3CH,iCAAKgC,UAAL;AACH,yBAFD,MAEM,IAAGF,KAAKG,yBAAL,CAA+BC,MAA/B,IAAyC,CAA5C,EAA8C;AAChDlC,iCAAKmC,UAAL;AACH,yBAFK,MAED;AACDnC,iCAAKoC,eAAL,CAAqBN,KAAKG,yBAA1B,EAAoDH,KAAK7B,KAAzD;AACAsB,oCAAQC,GAAR,CAAY,eAAZ;AACAlB,8BAAE,OAAF,EAAW+B,OAAX,CAAmB,QAAnB;AACH;;AAED,4BAAIC,KAAKjC,eAAekC,kBAAf,CAAkCd,KAAlC,CAAT;AACAe,+BAAOC,OAAP,CAAeC,SAAf,CAAyBjB,KAAzB,EAAgC,EAAhC,EAAoC,OAAOa,EAA3C;AACH,qBAfD;AAgBH;AAlCoB,aAAX,CAAd;;AAqCAE,mBAAO9B,MAAP,GAAgBV,KAAKU,MAArB;AACH,SAvCD;;AAyCA8B,eAAOG,UAAP,GAAoB,UAASC,KAAT,EAAe;AAC/B,gBAAInB,KAAJ;AACA,gBAAGmB,MAAMC,KAAT,EAAe;AAAE;AACbpB,wBAAQmB,MAAMC,KAAd;AACH,aAFD,MAEK;AAAC;AACF,oBAAIC,UAAUC,SAASC,IAAT,CAAcC,KAAd,CAAoB,QAApB,CAAd;AACA,oBAAIC,MAAMJ,QAAQ,CAAR,CAAV;AACA,oBAAGI,IAAIC,UAAJ,CAAe,GAAf,CAAH,EAAuB;AACnBD,0BAAMA,IAAIE,SAAJ,CAAc,CAAd,CAAN;AACH;;AAED3B,wBAAQpB,eAAegD,kBAAf,CAAkCH,GAAlC,CAAR;AACH;;AAEDlD,iBAAKU,MAAL,CAAY4C,QAAZ,CAAqBjD,eAAekD,mBAAf,CAAmC9B,KAAnC,CAArB;;AAEAzB,iBAAK6B,SAAL,CAAeJ,KAAf,EAAqB,UAASK,IAAT,EAAc;AAC/B,oBAAGA,KAAK5B,KAAL,IAAY,CAAZ,IAAiB4B,KAAK5B,KAAL,IAAYF,KAAKG,QAArC,EAA8C;AAAC;AAC3CH,yBAAKgC,UAAL;AACH;AACDhC,qBAAKoC,eAAL,CAAqBN,KAAKA,IAA1B,EAA+BA,KAAK5B,KAApC;AACH,aALD;AAMH,SAtBD;;AAwBA,cAAKsD,SAAL;AACA,cAAKC,QAAL;AA1EU;AA2Eb;;;;oCAEU;AACP,gBAAIzD,OAAO,IAAX;AACAM,cAAE,iBAAF,EAAqBoD,KAArB,CAA2B,YAAU;AACjC1D,qBAAKU,MAAL,CAAYiD,KAAZ;AACH,aAFD;AAGH;;;yCAEgB7B,I,EAAK;AAClB,gBAAIoB,MAAM,EAAV;AACApB,iBAAK8B,OAAL,CAAa,UAASC,IAAT,EAAc;AACvBX,uBAAO;;+BAAA,GAEaW,KAAKC,QAFlB,GAE2B;;;;yBAF3B,GAMOD,KAAKE,UANZ,GAMuB;;+BANvB,GAQaF,KAAKG,YARlB,GAQ+B,GAR/B,GAQmCH,KAAKI,QARxC,GAQiD,eARjD,GAQiEJ,KAAKK,UARtE,GAQiF,IARjF,GAQsFL,KAAKM,QAR3F,GAQoG;;;;;iDARpG,GAa+BN,KAAKO,SAbpC,GAa8C;;iBAbrD;AAgBH,aAjBD;;AAmBA,mBAAOlB,GAAP;AACH;;;wCAEepB,I,EAAK5B,K,EAAM;AAAC;AACxB,iBAAKyB,UAAL;AACA,gBAAGG,QAAQA,KAAKI,MAAhB,EAAuB;AACnB5B,kBAAE,UAAF,EAAc+D,IAAd;AACA,oBAAInB,MAAM,KAAKoB,gBAAL,CAAsBxC,IAAtB,CAAV;;AAEAxB,kBAAE,OAAF,EAAWiE,IAAX,CAAgBrB,GAAhB;AACA5C,kBAAE,eAAF,EAAmBa,IAAnB,CAAwBjB,KAAxB;AACAI,kBAAE,QAAF,EAAYkE,SAAZ;AACAC,2BAAW,YAAU;AACjBnE,sBAAE,QAAF,EAAYC,OAAZ;AACH,iBAFD,EAEG,IAFH;;AAIA,qBAAKmE,sBAAL;AACH,aAZD,MAYK;AAAC;AACF,qBAAKvC,UAAL;AACH;AACJ;;;wCAEeL,I,EAAK;AAAC;AAClB,gBAAGA,QAAMA,KAAKI,MAAd,EAAqB;AACjB,oBAAIgB,MAAM,KAAKoB,gBAAL,CAAsBxC,IAAtB,CAAV;AACAxB,kBAAE,OAAF,EAAWqE,MAAX,CAAkBzB,GAAlB;AACA,qBAAKwB,sBAAL;AACH,aAJD,MAIK;AAAC;AACF,qBAAK1C,UAAL;AACH;AACJ;;;qCAEW;AAAC;AACT1B,cAAE,UAAF,EAAcsE,IAAd;AACAtE,cAAE,cAAF,EAAkBiE,IAAlB,CAAuB,EAAvB;AACAjE,cAAE,iBAAF,EAAqBsE,IAArB,GAHQ,CAGoB;AAC/B;;;qCAEW;AACRtE,cAAE,UAAF,EAAc+D,IAAd;AACH;;;qCAEW;AAAC;AACT/D,cAAE,eAAF,EAAmBsE,IAAnB;AACH;;;qCAEW;AACRtE,cAAE,eAAF,EAAmB+D,IAAnB;AACH;;;mCAES,CAAC;;AAEV;;;kCAES5C,K,EAAMoD,O,EAAQC,K,EAAM;AAAC;AAC3B,gBAAI9E,OAAO,IAAX;AACA,iBAAK+E,WAAL;AACAzE,cAAE,OAAF,EAAW+B,OAAX,CAAmB,SAAnB;AACA,iBAAK2C,OAAL,CAAa,KAAKC,MAAL,CAAYC,EAAZ,CAAeC,IAA5B,EAAkC1D,KAAlC,EAAyC;AACrC2D,sBAAM,MAD+B;AAErCC,iCAAiBR,OAFoB;AAGrCS,+BAAeR,KAHsB;AAIrCS,kCAAkB,4BAAU;AACxBvF,yBAAKwF,WAAL;AACH;AANoC,aAAzC;AAQH;;;iDAEuB;AAAC;AACrB,gBAAIC,WAAW,IAAf;AACA,gBAAIC,QAAQpF,EAAE,8CAAF,CAAZ;AACA,gBAAGA,EAAE,oBAAF,EAAwB4B,MAAxB,IAAkC,CAAlC,IAAuCwD,MAAMxD,MAAN,GAAa,CAAvD,EAAyD;AACrD5B,kBAAE;;;yBAAA,GAGYmF,QAHZ,GAGqB;;;iBAHvB,EAMOE,WANP,CAMmBrF,EAAEoF,MAAM,CAAN,CAAF,CANnB;AAOH;AACD,gBAAGpF,EAAE,cAAF,EAAkB4B,MAAlB,IAA4B,CAA5B,IAAiCwD,MAAMxD,MAAN,GAAa,EAAjD,EAAoD;AAChD5B,kBAAE;;;;;;iBAAF,EAMOqF,WANP,CAMmBD,MAAM,EAAN,CANnB;AAOH;AACJ;;;oCAEU,CAAC;;AAEX;;;sCAEY;AACTpF,cAAE,eAAF,EAAmBsE,IAAnB;AACH;;;sCAEY;AACTtE,cAAE,eAAF,EAAmB+D,IAAnB;AACH;;;mCAES;AACN,gBAAIrE,OAAO,IAAX;;AAEA;AACAM,cAAE,OAAF,EAAWmD,QAAX,CAAoB;AAChBwB,wBAASjF,KAAKiF,MAAL,CAAYC,EAAZ,CAAeC,IADR;AAEhBS,mCAAoB,6BAAU;AAC1B,2BAAO5F,KAAKyB,KAAL,CAAWoE,EAAlB;AACA,2BAAO7F,KAAKyB,KAAZ;AACH,iBALe;AAMhBqE,6BAAa,MANG;AAOhBC,2BAAY,EAPI;AAQhB5F,0BAAU,EARM;AAShB6F,8BAAc,IATE;AAUhBC,6BAAa,IAVG;AAWhBC,0BAAW,kBAASpE,IAAT,EAAe;;AAEtB,wBAAI,CAACA,KAAKA,IAAN,IAAc,CAACA,KAAKA,IAAL,CAAUG,yBAAzB,IAAsD,CAACH,KAAKA,IAAL,CAAUG,yBAAV,CAAoCC,MAA/F,EAAsG;AAClGJ,6BAAK5B,KAAL,GAAa,CAAb;AACA;AACH;;AAEDF,yBAAKmG,eAAL,CAAqBrE,KAAKA,IAAL,CAAUG,yBAA/B;AACAO,2BAAOC,OAAP,CAAe2D,YAAf,CAA4BpG,KAAKyB,KAAjC,EAAwC,EAAxC,EAA4C,OAAOpB,eAAekC,kBAAf,CAAkCvC,KAAKyB,KAAvC,CAAnD,EARsB,CAQ4E;AACrG;AApBe,aAApB;AAsBH;;;;EA3OyB4E,U;;AAgP9B;;;;;AAGA/F,EAAEgG,QAAF,EAAYC,KAAZ,CAAkB,YAAW;AACzB,QAAIxG,cAAJ;AACH,CAFD","file":"list.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n 1. 项目名称：悟空找房h5\n 2. 页面名称：xf/list(新房-列表)\n 3. 作者：tangxuyang@lifang.com\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\n class ListController extends Controller {\n    constructor() {\n        super();\n        var self = this;\n        this.total = 0;//总数\n        this.count = 0;//当前数量\n        this.pageSize = 10;//\n        this.paramGenerator = new ParamGenerator();\n        $('.total').slideUp();\n        require(['../components/filter.min'], function(Filter){            \n            self.filter = new Filter({\n                el: \".filter\",\n                houseType: 1,\n                cityId: 43,\n                near: false,\n                longitude: 222,\n                latitude: 234,\n                distances: [{value: \"5000\", text: \"不限（智能范围）\"},{value: \"500\", text: \"500米\"},{value: \"1000\", text: \"1000米\"},{value: \"2000\", text: \"2000米\"},{value: \"5000\", text: \"5000米\"}],\n                controller: self,\n                filterChanged: function(result){ \n                    this.total = 0;\n                    this.count = 0;                    \n                    console.log(\"筛选条件变了：\", result);                                      \n                    var param = self.paramGenerator.generateParamObj(result);\n                    //param.pa = 1;\n                    self.param = param;\n                    self.hideNoData();\n                    self.hideNoMore();                    \n                    self.fetchData(param,function(data){\n                        data = data.data;\n                        $('.list').empty();\n                        if(data.total!=0 && data.total<=self.pageSize){// 没有更多了\n                            self.showNoMore();\n                        }else if(data.newHouseDataListModelList.length == 0){\n                            self.showNoData();\n                        }else{\n                            self.createHouseList(data.newHouseDataListModelList,data.total); \n                            console.log(\"有数据,enable...\");\n                            $('.list').trigger('enable');\n                        }\n                         \n                        var qs = ParamGenerator.object2QueryString(param);     \n                        window.history.pushState(param, \"\", \"./\" + qs);\n                    });\n                }                \n            });\n\n            window.filter = self.filter;\n        });\n\n        window.onpopstate = function(event){\n            var param;\n            if(event.state){ //如果有event.state，优先用\n                param = event.state;\n            }else{// 否则读取url中的最有一部分\n                var tempArr = location.href.split('xflist');\n                var str = tempArr[1];\n                if(str.startsWith('/')){\n                    str = str.substring(1);\n                }\n\n                param = ParamGenerator.queryString2Object(str);\n            }\n\n            self.filter.setValue(ParamGenerator.convert2FilterParam(param));\n\n            self.fetchData(param,function(data){\n                if(data.count!=0 && data.count<=self.pageSize){// 没有更多了\n                    self.showNoMore();\n                }\n                self.createHouseList(data.data,data.count);       \n            });            \n        };\n\n        this.bindEvent();\n        this.pullload();\n    }\n\n    bindEvent(){\n        var self = this;\n        $('.no-data button').click(function(){\n            self.filter.clear();\n        });\n    }    \n\n    createHouseItems(data){\n        var str = \"\";\n        data.forEach(function(item){\n            str += '<a class=\"xf-item\" href=\"/shanghai/rent/b5463d25fbc09ea7.html?channel=undefined\">\\\n                <div class=\"img\">\\\n                    <img src=\"'+item.imageUrl+'\">\\\n                    <div class=\"yh\">团购享 20万抵50万</div>\\\n                </div>\\\n                <div class=\"info\">\\\n                    <h3>'+item.estateName+'</h3>\\\n                    <p class=\"district-town-area\">\\\n                        <span>'+item.districtName+' '+item.townName+'</span><span>'+item.startSpace+'m-'+item.endSpace+'m</span>\\\n                    </p>\\\n                    <ul class=\"tags\">\\\n                        <li class=\"yh\">有优惠</li><li class=\"dt\">近地铁</li><li class=\"\">在售楼盘</li><li class=\"\">即将开盘</li><li class=\"\">即将开盘</li>\\\n                    </ul>\\\n                    <p class=\"unit-price\"><span>'+item.unitPrice+'</span> <span>元/m</span></p>\\\n                </div>\\\n            </a>';\n        });\n\n        return str;\n    }    \n\n    createHouseList(data,count){// 生成房源列表\n        this.hideNoData();\n        if(data && data.length){\n            $('.no-data').hide();\n            var str = this.createHouseItems(data);\n\n            $('.list').html(str);\n            $('.total .count').text(count);\n            $('.total').slideDown();\n            setTimeout(function(){\n                $('.total').slideUp();\n            }, 1500);\n\n            this.insertTrendAndOldHouse();\n        }else{// 没数据\n            this.showNoData();\n        }\n    }\n\n    appendHouseList(data){// 上拉滚动时加载数据\n        if(data&&data.length){\n            var str = this.createHouseItems(data);\n            $('.list').append(str);\n            this.insertTrendAndOldHouse();\n        }else{// 没有更多数据了\n            this.showNoMore();\n        }\n    }\n\n    showNoData(){// 显示没有数据，并显示新房楼盘推荐\n        $('.no-data').show();\n        $('.total + div').html('');\n        $('.recommendation').show();// TODO:显示推荐楼盘\n    }\n\n    hideNoData(){\n        $('.no-data').hide();\n    }\n\n    showNoMore(){// 显示没有更多\n        $('.reach-bottom').show();\n    }\n\n    hideNoMore(){\n        $('.reach-bottom').hide();\n    }\n\n    loadMore(){// 加载更多数据\n        \n    }\n\n    fetchData(param,success,error){// 获取列表数据\n        var self = this;\n        this.showLoading();\n        $('.list').trigger('disable');\n        this.request(this.apiUrl.xf.list, param, {\n            type: \"POST\",\n            successCallback: success,\n            errorCallback: error,\n            completeCallback: function(){\n                self.hideLoading();\n            }\n        });\n    }\n\n    insertTrendAndOldHouse(){// 插入跳转到价格行情和二手房的链接        \n        var cityName = \"上海\";\n        var $list = $('.list .xf-item:not(.house):not(.house-price)');\n        if($('.list .house-price').length == 0 && $list.length>9){\n            $('<a href=\"#\" class=\"xf-item house-price\">\\\n                <div class=\"img\"></div>\\\n                <div class=\"info\">\\\n                    <h3>'+cityName+'房价涨了还是跌了？</h3>\\\n                    <span class=\"detail\">去看看</span>\\\n                </div>\\\n            </a>').insertAfter($($list[9]));\n        }\n        if($('.list .house').length == 0 && $list.length>19){\n            $('<a href=\"#\" class=\"xf-item house\">\\\n                <div class=\"img\"></div>\\\n                <div class=\"info\">\\\n                    <h3>火爆高性价比二手房</h3>\\\n                    <span class=\"detail\">去看看</span>\\\n                </div>\\\n            </a>').insertAfter($list[19]);\n        }\n    }\n\n    showError(){// 接口报错，分为两种，1. 筛选条件变更刷新 2. 上拉加载\n\n    }\n\n    showLoading(){\n        $('.page-loading').show();\n    }\n\n    hideLoading(){\n        $('.page-loading').hide();\n    }\n\n    pullload(){\n        let self = this ;\n\n        //二手房\n        $(\".list\").pullload({\n            apiUrl : self.apiUrl.xf.list ,\n            queryStringObject : function(){\n                delete self.param.pa;\n                return self.param;\n            },   \n            requestType: \"POST\",\n            threshold : 50 ,\n            pageSize: 10,   \n            pageIndexKey: \"of\",\n            pageSizeKey: \"ps\",    \n            callback : function(data) {\n                \n                if( !data.data || !data.data.newHouseDataListModelList || !data.data.newHouseDataListModelList.length){\n                    data.count = 1;\n                    return;    \n                } \n\n                self.appendHouseList(data.data.newHouseDataListModelList);                \n                window.history.replaceState(self.param, \"\", \"./\" + ParamGenerator.object2QueryString(self.param));// 修改当前url    `\n            }\n        }) ;\n    }\n}\n\n\n\n/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n类的初始化\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\n$(document).ready(function() {\n    new ListController;\n});"]}