{"version":3,"sources":["xf/list.min.js"],"names":["ListController","self","total","count","pageSize","paramGenerator","ParamGenerator","$","slideUp","require","Filter","BigData","init","ConningTower","data","filter","extend","XFDEFAULT","el","cityId","near","longitude","latitude","controller","filterChanged","result","param","generateParamObj","location","href","object2QueryString","bindEvent","pullload","click","str","forEach","item","imageUrl","estateName","districtName","townName","startSpace","endSpace","unitPrice","hideNoData","length","hide","createHouseItems","html","text","slideDown","setTimeout","insertTrendAndOldHouse","showNoData","append","show","cityName","$list","insertAfter","apiUrl","xflist","queryStringObject","pa","requestType","threshold","pageIndexKey","pageSizeKey","callback","newHouseDataListModelList","appendHouseList","Controller","document","ready"],"mappings":"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","file":"list.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n 1. 项目名称：悟空找房h5\n 2. 页面名称：xf/list(新房-列表)\n 3. 作者：tangxuyang@lifang.com\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\n class ListController extends Controller {\n    constructor() {\n        super();\n        var self = this;\n        this.total = 0;//总数\n        this.count = 0;//当前数量\n        this.pageSize = 10;//\n        this.paramGenerator = new ParamGenerator();\n        $('.total').slideUp(1000);\n        require(['../components/filter.min', '../components/bigdata.min', \"../components/conning-tower.min\"], function(Filter, BigData){   \n            BigData.init(self);         \n            new ConningTower({                \n                \"bigDataUtil\" : BigData ,               \n                \"moduleType\" : \"xf\" ,\n                \"cityClick\" : () => {\n                    //alert(\"在二手房城市选择器中点选了城市\") ;\n                } ,\n                \"searchResultItemClick\" : (data) => {\n                    //alert(data) ;\n                }\n            }) ;\n\n            self.filter = new Filter($.extend({},Filter.XFDEFAULT,{\n                el: \".filter\",                \n                cityId: 43,\n                near: false,\n                longitude: 222,\n                latitude: 234,                \n                controller: self,\n                BigData: BigData,\n                filterChanged: function(result){ \n                    // 获得最新查询条件TODO: 还要集成搜索组件                                     \n                    var param = self.paramGenerator.generateParamObj(result);\n\n                    // 跳转\n                    location.href = './' +  ParamGenerator.object2QueryString(param);                    \n                }                \n            }));                     \n        });\n\n        this.bindEvent();\n        this.pullload();\n    }\n\n    bindEvent(){\n        var self = this;\n        // 清空查询条件\n        $('.no-data button').click(function(){\n            // 跳转            \n            location.href = \"./\";\n        });\n    }    \n\n    createHouseItems(data){\n        var str = \"\";\n        data.forEach(function(item){\n            str += '<a class=\"xf-item\" href=\"/shanghai/rent/b5463d25fbc09ea7.html?channel=undefined\">\\\n                <div class=\"img\">\\\n                    <img src=\"'+item.imageUrl+'\">\\\n                    <div class=\"yh\">团购享 20万抵50万</div>\\\n                </div>\\\n                <div class=\"info\">\\\n                    <h3>'+item.estateName+'</h3>\\\n                    <p class=\"district-town-area\">\\\n                        <span>'+item.districtName+' '+item.townName+'</span><span>'+item.startSpace+'m-'+item.endSpace+'m</span>\\\n                    </p>\\\n                    <ul class=\"tags\">\\\n                        <li class=\"yh\">有优惠</li><li class=\"dt\">近地铁</li><li class=\"\">在售楼盘</li><li class=\"\">即将开盘</li><li class=\"\">即将开盘</li>\\\n                    </ul>\\\n                    <p class=\"unit-price\"><span>'+item.unitPrice+'</span> <span>元/m</span></p>\\\n                </div>\\\n            </a>';\n        });\n\n        return str;\n    }    \n\n    createHouseList(data,count){// 生成房源列表\n        this.hideNoData();\n        if(data && data.length){\n            $('.no-data').hide();\n            var str = this.createHouseItems(data);\n\n            $('#list').html(str);\n            $('.total .count').text(count);\n            $('.total').slideDown();\n            setTimeout(function(){\n                $('.total').slideUp();\n            }, 1500);\n\n            this.insertTrendAndOldHouse();\n        }else{// 没数据\n            this.showNoData();\n        }\n    }\n\n    appendHouseList(data){// 上拉滚动时加载数据\n        if(data&&data.length){\n            var str = this.createHouseItems(data);\n            $('#list').append(str);\n            this.insertTrendAndOldHouse();\n        }else{// 没有更多数据了\n            //this.showNoMore();\n        }\n    }\n\n    showNoData(){// 显示没有数据，并显示新房楼盘推荐\n        $('.no-data').show();\n        $('.total + div').html('');\n        $('.recommendation').show();// TODO:显示推荐楼盘\n    }\n\n    hideNoData(){\n        $('.no-data').hide();\n    }\n\n    hideNoMore(){\n        $('.reach-bottom').hide();\n    }\n\n    insertTrendAndOldHouse(){// 插入跳转到价格行情和二手房的链接        \n        var cityName = \"上海\";\n        var $list = $('#list .xf-item:not(.house):not(.house-price)');\n        if($('#list .house-price').length == 0 && $list.length>9){\n            $('<a href=\"#\" class=\"xf-item house-price\">\\\n                <div class=\"img\"></div>\\\n                <div class=\"info\">\\\n                    <h3>'+cityName+'房价涨了还是跌了？</h3>\\\n                    <span class=\"detail\">去看看</span>\\\n                </div>\\\n            </a>').insertAfter($($list[9]));\n        }\n        if($('#list .house').length == 0 && $list.length>19){\n            $('<a href=\"#\" class=\"xf-item house\">\\\n                <div class=\"img\"></div>\\\n                <div class=\"info\">\\\n                    <h3>火爆高性价比二手房</h3>\\\n                    <span class=\"detail\">去看看</span>\\\n                </div>\\\n            </a>').insertAfter($list[19]);\n        }\n    }\n\n    showError(){// 接口报错，分为两种，1. 筛选条件变更刷新 2. 上拉加载\n\n    }\n\n    // 金箍棒loading效果，现在第一屏用同步输出 ，已经用不到了，先保留，后续删掉\n    // showLoading(){\n    //     $('.page-loading').show();\n    // }\n\n    // hideLoading(){\n    //     $('.page-loading').hide();\n    // }\n\n    // 上拉加载\n    pullload(){\n        let self = this ;\n\n        //二手房\n        $(\"#list\").pullload({\n            apiUrl : self.apiUrl.xflist ,\n            queryStringObject : function(){\n                self.param && delete self.param.pa;\n                if(!self.param){\n                    self.param = {};\n                }\n                return self.param;\n            },   \n            requestType: \"POST\",\n            threshold : 50 ,\n            pageSize: 10,   \n            pageIndexKey: \"of\",\n            pageSizeKey: \"ps\",    \n            callback : function(data) {\n                \n                if( !data.data || !data.data.newHouseDataListModelList || !data.data.newHouseDataListModelList.length){\n                    data.count = 1;\n                    return;    \n                } \n\n                self.appendHouseList(data.data.newHouseDataListModelList);                \n            }\n        }) ;\n    }\n}\n\n\n\n/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n类的初始化\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\n$(document).ready(function() {\n    new ListController;\n});"]}