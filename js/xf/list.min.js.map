{"version":3,"sources":["xf/list.min.js"],"names":["ListController","self","total","count","pageSize","paramGenerator","ParamGenerator","$","slideUp","require","Filter","filter","el","houseType","cityId","near","longitude","latitude","distances","value","text","controller","filterChanged","result","console","log","param","generateParamObj","hideNoData","hideNoMore","fetchData","data","showNoMore","createHouseList","qs","object2QueryString","window","history","pushState","onpopstate","event","state","tempArr","location","href","split","str","startsWith","substring","queryString2Object","bindEvent","pullload","click","clear","forEach","item","imageUrl","estateName","districtName","townName","startSpace","endSpace","unitPrice","length","hide","createHouseItems","html","slideDown","setTimeout","insertTrendAndOldHouse","showNoData","append","show","success","error","request","apiUrl","xf","list","type","successCallback","errorCallback","cityName","$list","insertAfter","getPageIndex","Math","ceil","queryStringObject","threshold","callback","appendHouseList","pa","replaceState","Controller","document","ready"],"mappings":"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","file":"list.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n 1. 项目名称：悟空找房h5\r\n 2. 页面名称：xf/list(新房-列表)\r\n 3. 作者：tangxuyang@lifang.com\r\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n class ListController extends Controller {\r\n    constructor() {\r\n        super();\r\n        var self = this;\r\n        this.total = 0;//总数\r\n        this.count = 0;//当前数量\r\n        this.pageSize = 10;//\r\n        this.paramGenerator = new ParamGenerator();\r\n        $('.total').slideUp();\r\n        require(['../components/filter.min'], function(Filter){            \r\n            self.filter = new Filter({\r\n                el: \".filter\",\r\n                houseType: 1,\r\n                cityId: 43,\r\n                near: false,\r\n                longitude: 222,\r\n                latitude: 234,\r\n                distances: [{value: \"5000\", text: \"不限（智能范围）\"},{value: \"500\", text: \"500米\"},{value: \"1000\", text: \"1000米\"},{value: \"2000\", text: \"2000米\"},{value: \"5000\", text: \"5000米\"}],\r\n                controller: self,\r\n                filterChanged: function(result){\r\n                    this.total = 0;\r\n                    this.count = 0;                    \r\n                    console.log(\"筛选条件变了：\", result);                                      \r\n                    var param = self.paramGenerator.generateParamObj(result);\r\n                    self.param = param;\r\n                    self.hideNoData();\r\n                    self.hideNoMore();\r\n                    self.fetchData(param,function(data){\r\n                        if(data.count!=0 && data.count<=self.pageSize){// 没有更多了\r\n                            self.showNoMore();\r\n                        }\r\n                        self.createHouseList(data.data,data.count);  \r\n                        var qs = ParamGenerator.object2QueryString(param);                        \r\n                        window.history.pushState(param, \"\", \"./\" + qs);       \r\n                    });\r\n                }                \r\n            });\r\n\r\n            window.filter = self.filter;\r\n        });\r\n\r\n        window.onpopstate = function(event){\r\n            var param;\r\n            if(event.state){ //如果有event.state，优先用\r\n                param = event.state;\r\n            }else{// 否则读取url中的最有一部分\r\n                var tempArr = location.href.split('xflist');\r\n                var str = tempArr[1];\r\n                if(str.startsWith('/')){\r\n                    str = str.substring(1);\r\n                }\r\n\r\n                param = ParamGenerator.queryString2Object(str);\r\n            }\r\n\r\n            self.fetchData(param,function(data){\r\n                if(data.count!=0 && data.count<=self.pageSize){// 没有更多了\r\n                    self.showNoMore();\r\n                }\r\n                self.createHouseList(data.data,data.count);       \r\n            });            \r\n        };\r\n\r\n        this.bindEvent();\r\n        this.pullload();\r\n    }\r\n\r\n    bindEvent(){\r\n        var self = this;\r\n        $('.no-data button').click(function(){\r\n            self.filter.clear();\r\n        });\r\n    }    \r\n\r\n    createHouseItems(data){\r\n        var str = \"\";\r\n        data.forEach(function(item){\r\n            str += '<a class=\"xf-item\" href=\"/shanghai/rent/b5463d25fbc09ea7.html?channel=undefined\">\\\r\n                <div class=\"img\">\\\r\n                    <img src=\"'+item.imageUrl+'\">\\\r\n                    <div class=\"yh\">团购享 20万抵50万</div>\\\r\n                </div>\\\r\n                <div class=\"info\">\\\r\n                    <h3>'+item.estateName+'</h3>\\\r\n                    <p class=\"district-town-area\">\\\r\n                        <span>'+item.districtName+' '+item.townName+'</span><span>'+item.startSpace+'m-'+item.endSpace+'m</span>\\\r\n                    </p>\\\r\n                    <ul class=\"tags\">\\\r\n                        <li class=\"yh\">有优惠</li><li class=\"dt\">近地铁</li><li class=\"\">在售楼盘</li><li class=\"\">即将开盘</li><li class=\"\">即将开盘</li>\\\r\n                    </ul>\\\r\n                    <p class=\"unit-price\"><span>'+item.unitPrice+'</span> <span>元/m</span></p>\\\r\n                </div>\\\r\n            </a>';\r\n        });\r\n\r\n        return str;\r\n    }    \r\n\r\n    createHouseList(data,count){// 生成房源列表\r\n        this.hideNoData();\r\n        if(data && data.length){\r\n            $('.no-data').hide();\r\n            var str = this.createHouseItems(data);\r\n\r\n            $('.list').html(str);\r\n            $('.total .count').text(count);\r\n            $('.total').slideDown();\r\n            setTimeout(function(){\r\n                $('.total').slideUp();\r\n            }, 1500);\r\n\r\n            this.insertTrendAndOldHouse();\r\n        }else{// 没数据\r\n            this.showNoData();\r\n        }\r\n    }\r\n\r\n    appendHouseList(data){// 上拉滚动时加载数据\r\n        if(data&&data.length){\r\n            var str = this.createHouseItems(data);\r\n            $('.list').append(str);\r\n            this.insertTrendAndOldHouse();\r\n        }else{// 没有更多数据了\r\n            this.showNoMore();\r\n        }\r\n    }\r\n\r\n    showNoData(){// 显示没有数据，并显示新房楼盘推荐\r\n        $('.no-data').show();\r\n        $('.total + div').html('');\r\n        $('.recommendation').show();// TODO:显示推荐楼盘\r\n    }\r\n\r\n    hideNoData(){\r\n        $('.no-data').hide();\r\n    }\r\n\r\n    showNoMore(){// 显示没有更多\r\n        $('.reach-bottom').show();\r\n    }\r\n\r\n    hideNoMore(){\r\n        $('.reach-bottom').hide();\r\n    }\r\n\r\n    loadMore(){// 加载更多数据\r\n        \r\n    }\r\n\r\n    fetchData(param,success,error){// 获取列表数据\r\n        this.request(this.apiUrl.xf.list, param, {\r\n            type: \"POST\",\r\n            successCallback: success,\r\n            errorCallback: error\r\n        });\r\n    }\r\n\r\n    insertTrendAndOldHouse(){// 插入跳转到价格行情和二手房的链接        \r\n        var cityName = \"上海\";\r\n        var $list = $('.list .xf-item:not(.house):not(.house-price)');\r\n        if($('.list .house-price').length == 0 && $list.length>9){\r\n            $('<a href=\"#\" class=\"xf-item house-price\">\\\r\n                <div class=\"img\"></div>\\\r\n                <div class=\"info\">\\\r\n                    <h3>'+cityName+'房价涨了还是跌了？</h3>\\\r\n                    <span class=\"detail\">去看看</span>\\\r\n                </div>\\\r\n            </a>').insertAfter($($list[9]));\r\n        }\r\n        if($('.list .price').length == 0 && $list.length>19){\r\n            $('<a href=\"#\" class=\"xf-item house\">\\\r\n                <div class=\"img\"></div>\\\r\n                <div class=\"info\">\\\r\n                    <h3>火爆高性价比二手房</h3>\\\r\n                    <span class=\"detail\">去看看</span>\\\r\n                </div>\\\r\n            </a>').insertAfter($list[19]);\r\n        }\r\n    }\r\n\r\n    showError(){// 接口报错，分为两种，1. 筛选条件变更刷新 2. 上拉加载\r\n\r\n    }\r\n\r\n    pullload(){\r\n        let self = this ;        \r\n        function getPageIndex() {\r\n            return Math.ceil($('.list .xf-item:not(.house-price):not(.price)').length / 10) || 1;\r\n        }\r\n\r\n        //二手房\r\n        $(\".list\").pullload({\r\n            apiUrl : \"https://m.wkzf.com/xflist/houselist.rest\" ,\r\n            queryStringObject : function(){\r\n                return self.param;\r\n            },   \r\n            threshold : 50 ,\r\n            pageSize: 10,       \r\n            callback : function(data) {\r\n                if( ! data.data) return ;                \r\n                self.appendHouseList(data.data);\r\n                self.param.pa = getPageIndex();\r\n                window.history.replaceState(self.param, \"\", \"./\" + ParamGenerator.object2QueryString(self.param) );// 修改当前url    `\r\n            }\r\n        }) ;\r\n    }\r\n}\r\n\r\n\r\n\r\n/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n类的初始化\r\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n$(document).ready(function() {\r\n    new ListController;\r\n});"]}