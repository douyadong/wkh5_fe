'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：悟空找房h5
 2. 页面名称：rent/list(租房-列表)
 3. 作者：liyang@lifang.com
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

var ListController = function (_Controller) {
    _inherits(ListController, _Controller);

    function ListController() {
        _classCallCheck(this, ListController);

        var _this = _possibleConstructorReturn(this, (ListController.__proto__ || Object.getPrototypeOf(ListController)).call(this));

        var self = _this;
        $('.total').slideUp();
        require(['../components/filter.min'], function (Filter) {
            self.filter = new Filter({
                el: ".filter",
                houseType: 1,
                cityId: 43,
                controller: self,
                filterChanged: function filterChanged(result) {
                    console.log("筛选条件变了：", result);
                    var param = {
                        subWayLineId: result.metroKey,
                        districtAndTown: result.districtPinyin,
                        pinyin: "shanghai"
                    };
                    console.log("参数：", param);
                    self.request("https://m.wkzf.com/xflist/houselist.rest", param, {
                        successCallback: function successCallback(data) {
                            self.createHouseList(data.data);
                        }
                    });
                }
            });
        });

        _this.bindEvent();
        return _this;
    }

    _createClass(ListController, [{
        key: 'bindEvent',
        value: function bindEvent() {
            var self = this;
            $('.no-data button').click(function () {
                self.filter.clear();
            });
        }
    }, {
        key: 'createHouseList',
        value: function createHouseList(data) {
            // 生成房源列表
            if (data && data.length) {
                $('.no-data').hide();
                var str = "";
                data.forEach(function (item) {
                    str += '<a class="xf-item">\
                <div class="img">\
                    <img src="' + item.imageUrl + '">\
                    <div class="yh">团购享 20万抵50万</div>\
                </div>\
                <div class="info">\
                    <h3>' + item.estateName + '</h3>\
                    <p class="district-town-area">\
                        <span>' + item.districtName + ' ' + item.townName + '</span><span>' + item.startSpace + 'm-' + item.endSpace + 'm</span>\
                    </p>\
                    <ul class="tags">\
                        <li class="yh">有优惠</li><li class="dt">进地铁</li><li class="">在售楼盘</li><li class="">即将开盘</li><li class="">即将开盘</li>\
                    </ul>\
                    <p class="unit-price"><span>' + item.unitPrice + '</span> <span>元/m</span></p>\
                </div>\
            </a>';
                });

                $('.total + div').html(str);
                $('.total').slideDown();
                setTimeout(function () {
                    $('.total').slideUp();
                }, 1500);
            } else {
                // 没数据
                this.showNoData();
            }
        }
    }, {
        key: 'showNoData',
        value: function showNoData() {
            // 显示没有数据，并显示新房楼盘推荐
            $('.no-data').show();
            $('.total + div').html('');
            $('.recommendation').html('');
        }
    }]);

    return ListController;
}(Controller);

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/


$(document).ready(function () {
    new ListController();
});
//# sourceMappingURL=list.min.js.map
