"use strict";function _possibleConstructorReturn(a,t){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?a:t}function _inherits(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);a.prototype=Object.create(t&&t.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(a,t):a.__proto__=t)}function _classCallCheck(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}return function(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}}(),Pagination=function(){function a(t){_classCallCheck(this,a),this.setOptions(t),this.options.callback(),this.bindEvent()}return _createClass(a,[{key:"setOptions",value:function(a){var t={total:1,prePages:5,sufPages:4,dotsPages:7,showDotPages:3,sidePages:1,callback:null,container:null,numberStyle:""};$.extend(!0,this.options={},t,a)}},{key:"genPageNumber",value:function(a,t){var e=this,n=e.options.prePages,i=e.options.sufPages,o=e.options.dotsPages,r=e.options.showDotPages,s=e.options.sidePages,c=t||e.options.total,l=e.options.numberStyle,u="<a href='javascript:;' class='"+l+" page-link on'>"+a+"</a>";if(c<o){for(var p=a-1;p>=1;p--)u="<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"+u;for(var p=a+1;p<=c;p++)u=u+"<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"}else if(a<r+1){for(var p=a-1;p>=1;p--)u="<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"+u;for(var p=a+1;p<=n;p++)u=u+"<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>";u+="<span>...</span>",u=u+"<a href='javascript:;' class='"+l+" page-link'>"+c+"</a>"}else if(c-a<r){for(var p=a+1;p<=c;p++)u=u+"<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>";for(var p=a-1;p>c-i;p--)u="<a href='javascript:;' class='"+l+" page-link'>"+p+"</a>"+u;u="<span>...</span>"+u,u="<a href='javascript:;' class='"+l+" page-link'>1</a>"+u}else{for(var p=1;p<=s;p++)a-p>1&&(u="<a href='javascript:;' class='"+l+" page-link'>"+(a-p)+"</a>"+u),a-0+p<=c&&(u=u+"<a href='javascript:;' class='"+l+" page-link'>"+(a-0+p)+"</a>");a-s>1&&(u="<a href='javascript:;' class='page-link'>1</a><span>...</span>"+u),a+s<c&&(u=u+"<span>...</span><a href='javascript:;' class='"+l+" page-link'>"+c+"</a>")}u=1==a?"<a href='javascript:;' data-type='pre' data-pageindex='"+a+"' class='page-link disabled'>上一页</a>"+u:"<a href='javascript:;' data-type='pre' data-pageindex='"+a+"' class='page-link'>上一页</a>"+u,u=a==c?u+"<a href='javascript:;' data-type='next' data-pageindex='"+a+"' class='page-link disabled'>下一页</a>":u+"<a href='javascript:;' data-type='next' data-pageindex='"+a+"' class='page-link'>下一页</a>",e.options.container.append(u)}},{key:"bindEvent",value:function(){var a=this;a.options.container.undelegate("a","click").delegate("a","click",function(t){var e=$(this),n=parseInt(e.text()),i=e.data("type"),o=parseInt(e.attr("data-pageindex"));if(!e.hasClass("disabled")&&!e.hasClass("on")){switch(i){case"pre":n=o-1;break;case"next":n=o+1}n&&a.options.callback&&a.options.callback(n)}})}}]),a}();!function(a){var t=function n(t,e){this.$element=a(t),this.$Audio=this.$element.children("#media"),this.Audio=this.$Audio[0],this.$audio_area=this.$element.find("#audio_area"),this.$audio_length=this.$element.find("#audio_length"),this.$audio_progress=this.$element.find("#audio_progress"),this.currentState="pause",this.time=null,this.options=a.extend({},n.defaults,e),this.init()};t.pluginName="wechatAudio",t.dataName="wechataudio",t.version="1.0.0",t.defaults={autoplay:!1,src:"",callback:a.noop};t.prototype={init:function(){var a=this;a.Audio.addEventListener("durationchange",function(t){a.updateTotalTime(t.target.duration),console.log(t.target.duration)}),a.events(),""!==a.options.src&&a.changeSrc(a.options.src,this.options.callback),a.options.autoplay&&a.play()},play:function(){var a=this;return"play"===a.currentState?void a.pause():(a.Audio.play(),clearInterval(a.timer),a.timer=setInterval(a.run.bind(a),50),a.currentState="play",void a.$audio_area.addClass("playing"))},pause:function(){var a=this;a.Audio.pause(),a.currentState="pause",clearInterval(a.timer),a.$audio_area.removeClass("playing")},stop:function(){},events:function(){var a,t=this;t.$audio_area.on("click",function(){t.play(),a||(t.updateTotalTime(),a=!0)})},run:function(){var a=this;a.animateProgressBarPosition(),a.Audio.ended&&a.pause()},animateProgressBarPosition:function(){var a=this,t=100*a.Audio.currentTime/a.Audio.duration+"%";"NaN%"==t&&(t="0%");var e={width:t};a.$audio_progress.css(e)},getAudioSeconds:function(a){var t=this,a=a%60;return a=t.addZero(Math.floor(a),2),a=a<60?a:"00"},getAudioMinutes:function(a){var t=this,a=a/60;return a=t.addZero(Math.floor(a),2),a=a<60?a:"00"},addZero:function(a,t){var a=String(a);return a},updateTotalTime:function(a){var t=this,a=a||t.Audio.duration,e=t.getAudioMinutes(a),n=t.getAudioSeconds(a),i="";i="00"==e?n+"''":e+"'"+n+"''",t.$audio_length.text(i)},changeSrc:function(a,t){var e=this;return e.pause(),e.Audio.src=a,e.play(),t(),this}};var e=a.fn[t.pluginName];a.fn[t.pluginName]=function(e,n){return this.each(function(){var i=a(this),o=i.data(t.dataName),r="object"==("undefined"==typeof e?"undefined":_typeof(e))&&e;return o||i.data(t.dataName,o=new t(this,r)),"string"==typeof e&&o[e](n),this})},a.fn[t.pluginName].Constructor=t,a.fn[t.pluginName].noConflict=function(){return a.fn[t.pluginName]=e,this}}(window.Zepto||window.jQuery);var ArticleShareController=function(a){function t(a){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=e;if(require(["../components/bigdata.min"],function(a){a.init(n)}),e.setOptions(a),e.setArticleFont(),e.articleId=$.trim($("#articleId").val()),e.cityId=$.trim($("#cityId").val()),e.refreshComment(),e.bindEvent(),e.convertLink(),e.convertVideo(),e.openInApp(),e.initWxShare(),e.loginStatus=!1,e.textareaHeight=$(".commentArea").find("textarea").height(),e.wkBigDataParams={pageName:1022,pageParam:{article_id:e.articleId},eventName:"",eventParam:{},nextPageName:"",nextPageParam:{},city:$("#cityId").val()},location.href.indexOf("#")>0&&"#comment-box"==location.href.slice(location.href.lastIndexOf("#"))){clearTimeout(i);var i=setTimeout(function(){$("html,body").scrollTop($("#comment-box").offset().top-200)},300)}return e}return _inherits(t,a),_createClass(t,[{key:"initWxShare",value:function(){}},{key:"openInApp",value:function(){var a=this.cityId,t=this.articleId;$(".download-app .download").click(function(){nativeSchema.loadSchema({schema:"external_call/parameter?t=0&bt=30&cd="+a+"&articleId="+t,protocal:"wkzf",loadWaiting:"1500",failUrl:"https://m.wkzf.com/download/transit?from=esfDetail",apkInfo:{PKG:"com.wukong.ua",CATEGORY:"android.intent.category.DEFAULT",ACTION:"android.intent.action.VIEW"}})})}},{key:"getQueryString",value:function(a,t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=a.match(e),i="";return null!=n&&(i=n[2]),e=null,n=null,null==i||""==i||"undefined"==i?"":i}},{key:"convertLink",value:function(){var a=this,t=$(".article-content").find("a");return!(!t||!t.length)&&void $.each(t,function(t,e){var n=$(e),i=n.attr("href");if(i){var o,r,s=i.split("?");s&&("wkzf://discovery/parameter?articleId="===s[0]?s[1]&&(o=a.getQueryString(s[1],"articleId"),n.attr("href","/article/app-share."+o+".html")):"wkzf://discovery/parameter?categoryId="===s[0]&&s[1]&&(r=a.getQueryString(s[1],"categoryId"),n.attr("href","/category/app."+r+".html?cityId="+a.cityId)))}})}},{key:"convertVideo",value:function(){var a=$(".article-content").find("embed");return!(!a||!a.length)&&void $.each(a,function(a,t){var e,n,i=$(t),o=$.trim($("#coverUrl").val()),r=i.attr("src"),s=r&&r.split("."),c=s[s.length-1];"mp3"===c.toLowerCase()?(n='<p class="weixinAudio">',n+='<audio src="'+r+'" id="media" width="1" height="1" preload="auto"></audio>',n+='<span id="audio_area" class="db audio_area">',n+='<span class="audio_arrow_back"></span>',n+='<span class="audio_arrow"></span>',n+='<span class="audio_wrp db">',n+='<span class="audio_play_area">',n+='<i class="icon_audio_default"></i>',n+='<i class="icon_audio_playing"></i>',n+="</span>",n+='<span id="audio_progress" class="progress_bar"></span>',n+="</span>",n+="</span>",n+='<span id="audio_length" class="audio_length tips_global"></span>',n+="</p>",i.after($(n)),i.remove()):(e=$('<video src="'+i.attr("src")+'" controls="controls">您的浏览器不支持 video 标签。</video>'),e.attr({poster:o,preload:"auto"}),i.attr({type:"",width:"100%",height:"100%"}),i.after(e),i.remove()),$(".weixinAudio").wechatAudio({autoplay:!1})})}},{key:"refreshComment",value:function(){var a=this,t=new Pagination({prePages:4,callback:function(e){e=e||1;var n=10*(e-1);a.request(a.apiUrl.article.commentList,{articleId:a.articleId,pageIndex:n},{successCallback:function(n){return a.createCommentList(n),$(".pagination").empty(),n.count?($(".pagination").show(),void t.genPageNumber(e,Math.ceil(n.count/10))):($(".pagination").hide(),!1)}})},container:$(".pagination"),numberStyle:"page-number"})}},{key:"createCommentList",value:function(a){var t=[];return!(!a.data||!a.data.length)&&($(".comment-list").empty(),$.each(a.data,function(a,e){t.push('<div class="item">'),t.push('<div class="commenter pb-10">'),t.push('<img src="'+e.guestPhoto+'" alt="">'),t.push('<span class="name">'+(e.guestNickname?e.guestNickname.replace(":",""):"")+"</span>"),t.push("</div>"),t.push('<div class="content pb-10">'+e.commentContent+"</div>"),t.push('<div class="datetime">'),t.push('<span class="date">'+e.date+"</span>"),t.push('<span class="time">'+e.time+"</span>"),t.push("</div>"),t.push("</div>")}),void $(".comment-list").append(t.join("")))}},{key:"setArticleFont",value:function(){$(".article-content").show()}},{key:"bindEvent",value:function(){var a=this;$(".collect").on("click",function(){var t=$(this),e=t.find("i").first();Login.isLoginCheck(function(){e.hasClass("icon-shoucang")&&a.Operation.collect({articleId:a.articleId},function(){e.removeClass("icon-shoucang").addClass("icon-yishoucang"),a.Operation.showMessage("收藏成功，可至APP收藏中查看！"),a.wkBigDataParams.eventName=1022001,a.wkBigDataParams.eventParam={article_id:a.articleId,collect:1},lifang.sendWKBigData(a.wkBigDataParams)}),e.hasClass("icon-yishoucang")&&a.Operation.cancelCollection({articleId:a.articleId},function(){e.removeClass("icon-yishoucang").addClass("icon-shoucang"),a.wkBigDataParams.eventName=1022001,a.wkBigDataParams.eventParam={article_id:a.articleId,collect:0},lifang.sendWKBigData(a.wkBigDataParams)})})}),this.addListenerToDownloadApp(),$(".download-app .icon-remove").click(function(){$(".details-container").css({"padding-bottom":50})}),$(".download-app dl").click(function(){var a=$("#categoryId").val(),t=$("#cityId").val();location.href="/category/app."+a+".html?cityId="+t}),$(".zan").on("click",function(){var t=$(this);t.find("i").first();return t.hasClass("active")?void $.tips("您已经赞过",2):void a.request(a.apiUrl.article.zan,{articleId:a.articleId},{successCallback:function(a){if(1===a.status&&a.data){var e=t.children("span").text()||0;e=/^\d*$/.test(e)?parseInt(e)<9999?parseInt(e)+1:"1万+":t.text(),t.addClass("active").find("span").text(a.data)}}})}),$('[name="comment"]').keyup(function(){var a=$(this),t=a.val();t&&t.length>0?(a.parent().css("border-color","#76B4E8"),$(".comment .submit").css({color:"#4081D6","border-color":"#4081D6"})):(a.parent().css("border-color","#E4E4E4"),$(".comment .submit").css({color:"#999","border-color":"#999"}))}),$(".comment").on("click",".cancel",function(){var t=$('[name="comment"]');t.val("").height(a.textareaHeight||75),t.parent().css("border-color","#E4E4E4"),$(".comment .submit").css({color:"#999","border-color":"#999"})});var t=!1;$(".comment").on("click",".submit",function(e){if(e.preventDefault(),!t){var n=$("[name=comment]"),i=$.trim(n.val());if(0===i.length)return $.tips("评论内容不能为空",1),!1;$(".comment .submit").css({color:"#999","border-color":"#999"}),t=!0,a.request(a.apiUrl.article.comment,{articleId:a.articleId,comment:i},{successCallback:function(e){if($(".comment .submit").css({color:"#4081D6","border-color":"#4081D6"}),t=!1,1===e.status&&e.data){$.tips("评论成功",2);var i=$("#comment-box").find(".count"),o=parseInt(i.text())||0,r=i.text();o?e.data.commentNumStr?i.text(e.data.commentNumStr):/^\d*$/.test(r)&&(parseInt(r)<9999?i.text(parseInt(r)+1):i.text("1万+")):$("#comment-box").find(".title").empty().append('评论（<span class="count">1</span> )'),$(".no-commet").remove(),n.val(""),$(".comment .submit").css({color:"#999","border-color":"#999"}),$("html,body").scrollTop($("#comment-box").offset().top-200),a.refreshComment()}else $.tips("评论失败",2)}})}}),window.addEventListener("resize",function(a){var t=$('[name="comment"]');t.scrollIntoView(!1)})}},{key:"setOptions",value:function(a){var t={};$.extend(!0,this.options={},t,a)}}]),t}(Controller);$(document).ready(function(){new ArticleShareController});
//# sourceMappingURL=app-share.min.js.map
