/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：悟空找房h5
 2. 页面名称：components -> conning-tower(列表页司令塔，包括返回、搜索、汉堡菜单等信息)
 3. 作者：zhaohuagang@lifang.com
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 class ConningTower {
     constructor({ apiUrl }) {         
         this.apiUrl = apiUrl ;  //搜索用的接口地址
         this.addEventListener() ;  
     }
     addEventListener() {
         /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        点击汉堡菜单弹出子菜单
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".conning-tower .hamburg-menu").click(() => {
            $(document.body).css({ "overflow-y" : "hidden" }) ;  //滚动条隐藏
            $(".navigator-mask").fadeIn(100) ;
            $(".navigator-pop").animate( {
                right : 0
            } , 100 ) ;
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        点击子菜单遮罩关闭子菜单
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".navigator-mask").click(() => {
            $(document.body).css({ "overflow-y" : "auto" }) ;  //如果有滚动条就显示  
            $(".navigator-mask").fadeOut(100) ;
            $(".navigator-pop").animate( {
                right : "-200px"
            } , 100 ) ;              
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        点击子菜单遮罩关闭子菜单
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".conning-tower .back").click(() => {
            history.back() ;
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        点击假的搜索区域出现真的搜索
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".conning-tower dl dd").click(() => {
            $(".substitute-mask").show(50) ;
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        真搜索区域返回按钮事件监听
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".substitute-mask .search-substitute .back").click(() => {
            $(".substitute-mask").hide(50) ;
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        真搜索区域清除输入图标事件监听
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".substitute-mask .search-substitute .input-section .icon-close").click(() => {
            $(".substitute-mask .search-substitute .input-section input").val("") ;
            $(".substitute-mask .list").empty() ;
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        pop菜单中的下载APP菜单事件监听
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".navigator-pop .app-download").click(() => {
            nativeSchema.loadSchema({               
                schema : "external_call"  ,  // 通过NN打开某个链接
                protocal : "wkzf" , //schema头协议，实际情况填写
                loadWaiting : "1500" , //发起唤醒请求后，会等待loadWaiting时间，超时则跳转到failUrl，默认3000ms                
                failUrl : "https://m.wkzf.com/download/transit?from=esfList" ,  //唤起失败时的跳转链接，默认跳转到下载页
                // apk信息,请根据实际情况填写
                apkInfo : {
                    PKG : "com.wukong.ua" ,
                    CATEGORY : "android.intent.category.DEFAULT" ,
                    ACTION : "android.intent.action.VIEW"
                }
            }) ;
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        真搜索区域输入监听
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        let $input = $(".substitute-mask .search-substitute .input-section input") ;
        $input.keyup(() => {                    
            try {
                $.ajax({
                    url : this.apiUrl ,                    
                    data : { "keyword" : $.trim($input.val()) } ,
                    dataType : "json" ,                            
                    error : function(e) {
                        console.log("调用数据接口失败！请测试您的数据接口！") ;                                   
                    } ,
                    success : function(data) {                
                        if (data.status.toString() === "1")  {
                            //获取到接口数据，进行绘制
                        }
                        else console.log(data.message) ;
                    }
                }) ;
            }
            catch(e) {
                console.log( "错误名称：" + e.name + "\n错误描述：" + e.message ) ;
            }
        }) ;
     }
 }
